# Dockerfile.jenkins-agent
FROM jenkins/inbound-agent:latest

USER root

# Install base tools (apt-based image assumed)
RUN apt-get update && apt-get install -y --no-install-recommends \
    curl unzip ca-certificates gnupg lsb-release apt-transport-https \
    jq make git python3 python3-pip \
    && rm -rf /var/lib/apt/lists/*

# Install awscli v2
RUN curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o /tmp/awscliv2.zip \
  && unzip /tmp/awscliv2.zip -d /tmp && /tmp/aws/install && rm -rf /tmp/aws* /tmp/awscliv2.zip

# Install kubectl
RUN curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl" \
  && install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl \
  && rm -f kubectl

# Install terraform (latest 1.x)
RUN curl -LO https://releases.hashicorp.com/terraform/1.5.7/terraform_1.5.7_linux_amd64.zip \
  && unzip terraform_1.5.7_linux_amd64.zip -d /usr/local/bin \
  && rm terraform_1.5.7_linux_amd64.zip

# (Optional) install minikube binary (useful for agents that will control minikube)
RUN curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64 \
  && install minikube-linux-amd64 /usr/local/bin/minikube \
  && rm minikube-linux-amd64

USER jenkins
